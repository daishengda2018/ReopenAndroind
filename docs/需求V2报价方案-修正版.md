# 需求V2升级版报价方案（修正版）

> **修正说明**：本文档基于 `development_tasks.md` 和原始需求文档进行了修正，确保与实际需求一致。

## 一、项目背景

- **原版本（V1）开发工作量**：20人天
- **原版本开发成本**：20人天 × 800元/天 = **16,000元**
- **当前版本**：需求V2（升级版）

---

## 二、功能对比总览（修正）

| 功能模块 | V1 | V2 | 变化类型 |
|---------|----|----|---------|
| BPPC表格 | ✅ | BP表格 | 升级 ⬆️ |
| BWL表格 | ✅ | W/L输赢表格 | 升级 ⬆️ |
| 排列组合形态柱状图 | ✅ | 数字形态柱状图 | 升级 ⬆️ |
| 押注方向导航表1（连跳） | ✅ | "连跳"三珠路表格 | **整合** 🔀 |
| 押注方向导航表2（九宫格） | ✅ | 九宫格 | 升级 ⬆️ |
| 操盘日记白板 | ✅ | 白板 | 升级 ⬆️ |
| 计时器 | ✅ | 计时器 | 升级 ⬆️ |
| - | - | BP形态押注表格 | **新增** 🆕 |
| - | - | 随机形态表格 | **新增** 🆕 |
| - | - | 参数面板（资金管理）| **新增** 🆕 |
| - | - | 软件锁死功能 | **新增** 🆕 |
| - | - | 自动暂存功能 | **新增** 🆕 |
| - | - | 保存/新牌逻辑优化 | **新增** 🆕 |

**统计**：
- 新增功能：6个
- 升级功能：5个
- 整合功能：1个
- **UI/UX重构**：全面布局调整

---

## 三、详细功能差异分析（基于development_tasks.md）

### （一）新增功能模块

#### 1. BP形态押注表格 🆕

**需求来源**：需求V2 第二部分

**功能描述**：
- 表格和数字与BP表格相同
- 四个套圈按钮（12、34、56、78）
- 复杂的套圈规则：
  - 按"12"时：给2套红圈，3套蓝圈；押注"2"时：给1套红圈，4套蓝圈
  - 按"34"时：给4套红圈，1套蓝圈；押注"4"时：给3套红圈，2套蓝圈
  - 按"56"时：给6套红圈，7套蓝圈；押注"6"时：给5套红圈，8套蓝圈
  - 按"78"时：给8套红圈，5套蓝圈；押注"8"时：给7套红圈，6套蓝圈

**开发难度**：⭐⭐⭐（中等）
**工作量评估**：2.5人天

---

#### 2. 随机形态表格 🆕

**需求来源**：需求V2 第四部分

**功能描述**：
- 从历史数据库选择样板牌与开牌对比
- 对比结果以"正"或"反"形态记录（B-B/P-P为正，B-P/P-B为反）
- 形态编号：正正正=1，反反反=2，正正反=3等
- 套圈按钮（ZF和Z/F）
- 样板牌选择条件：
  - 出现4个红圈的牌
  - 出现4个蓝圈的牌
  - 出现5个红蓝圈（不限顺序）的牌
- **关键特性**：样板牌数据以浅灰色调显示在三珠路表格中，进行中的牌局每开一手牌覆盖对应的样板牌数据

**技术难点**：
- 历史数据库查询和筛选
- 正反形态对比算法
- 浅灰色叠加绘制（Canvas）

**开发难度**：⭐⭐⭐⭐⭐（高）
**工作量评估**：5人天

---

#### 3. 参数面板（资金管理系统）🆕

**需求来源**：需求V2 第六.2部分

**功能描述**：
- 17个参数项，涵盖金额、时间、次数、统计等
- **三级联动逻辑**：局 → 场 → 轮
  - 局目标：每次操盘输赢结果，完成后归零
  - 场目标：最大负振幅（第1项），达标后累加到轮并归零
  - 轮目标：10个场目标，完成后归零

**17个参数详情**：
| 序号 | 参数名称 | 类型 | 说明 |
|------|---------|------|------|
| 1-4 | 输入金额 | 可输入 | 最大4位数 |
| 5 | 限制时间 | 可输入 | 分钟 |
| 6 | 存款次数 | 只读 | 累计值 |
| 7 | 累计存款金额 | 只读 | 累计值 |
| 8 | 累计提款金额 | 只读 | 累计值 |
| 9 | 账户存款余额 | 只读 | =最后一次存款 |
| 10 | 第"几"轮 | 只读 | 计数器 |
| 11 | 轮内资金累计余额 | 只读 | 10个场累加 |
| 12 | 轮资金累计余额 | 只读 | 累计值 |
| 13 | 账户资金累计余额 | 只读 | =第16+11+9项 |
| 14 | 第"几"场 | 只读 | 计数器 |
| 15 | 局输赢金额 | 可输入 | 手动输入 |
| 16 | 场内资金余额 | 只读 | =第15项累加 |
| 17 | 局输赢金额累计平均值 | 只读 | =Σ(第15项)/局数 |

**开发难度**：⭐⭐⭐⭐（中高）
**工作量评估**：4人天

---

#### 4. 自动暂存功能 🆕

**需求来源**：需求V2 第五.3.2-(4)部分

**功能描述**：
- 防止误碰"新牌"导致数据丢失
- 所有内容即时自动"暂存"
- 使用 DataStore 或 SharedPreferences
- 监听状态变化，防抖处理（500ms）
- App启动时检查并提示恢复

**开发难度**：⭐⭐⭐（中等）
**工作量评估**：1.5人天

---

#### 5. 软件锁死功能 🆕

**需求来源**：需求V2 第六.1部分

**功能描述**：
- 可以设定软件锁死时间
- 一旦锁死功能启动不能撤销
- 禁用所有输入操作
- 显示倒计时

**开发难度**：⭐⭐（较低）
**工作量评估**：1人天

---

#### 6. 保存/新牌逻辑优化 🆕

**需求来源**：需求V2 第五.3.2-(6)(7)(8)部分

**功能描述**：
- **保存按钮**：保存所有内容（BP表格、W/L表格、参数、白板）
- **新牌按钮**：只保存W/L表格、参数区、白板（不保存BP表格）
- 保存过的内容可以撤销和再编辑
- 按新牌后，W/L表格、参数面板、白板内容保留

**开发难度**：⭐⭐⭐（中等）
**工作量评估**：1.5人天

---

### （二）整合功能模块

#### "连跳"三珠路表格 🔀

**需求来源**：需求V2 第三部分

**V1状态**：ABC三路分开的连跳表格（12/56、34/78）

**V2变化**：
- ✅ 整合为单一表格
- ✅ 数字含义：1=连连，2=跳跳，3=连跳，4=跳连
- ✅ 12和34互为反形态
- ✅ 四个套圈按钮："12"、"34"、"ZF"、"Z/F"（ZF和Z/F放右边）
- ✅ 套圈规则：
  - 按"1"时：只给2套蓝圈
  - 按"2"时：只给1套蓝圈
  - "ZF"：紧连的正反形态套红蓝圈
  - "Z/F"：隔一的正反形态套红蓝圈
- ✅ 同步标记（与BP表格完全同步）
- ✅ 统计显示：连跳合计数（#）、跳数、连数、连跳差数
- ✅ 连跳合计数比BP合计数少1个

**开发难度**：⭐⭐⭐⭐（中高）
**工作量评估**：3.5人天

---

### （三）升级功能模块

#### 1. BP表格（原BPPC表格）

**需求来源**：需求V2 第一部分

**V2新增功能**：
- ✅ 套圈功能（"ZF"和"Z/F"按钮）
- ✅ "ZF"给紧连的正反形态套红蓝圈
- ✅ "Z/F"给隔一的正反形态套红蓝圈
- ✅ 与W/L表格同步显示押注位置和输赢符号
- ✅ 撤销符号时是独立不同步的
- ✅ 表格分隔线：第5、15列细线，第10、20列粗线
- ✅ 表格编号系统（保存一次增加一个编号，最大99999）
- ✅ 时区设置（默认加拿大温哥华）
- ✅ 统计数据顺序调整：# → P → B → 差数
- ✅ 取消表格上方列数号

**开发难度**：⭐⭐⭐（中等）
**工作量评估**：3人天

---

#### 2. W/L输赢表格（原BWL表格）

**需求来源**：需求V2 第五.1部分

**V2新增功能**：
- ✅ 前5列显示上一个表格的数据（打浅底色）
- ✅ 数字2和7套蓝色圈
- ✅ **数字2报警**：蓝色圈闪烁+声音，直到数字2消失
- ✅ 表格编号系统（00001~99999，每25列换新表）
- ✅ 统计数据顺序调整：# → L → W → 差数
- ✅ 历史累计数据移到表格下方
- ✅ 表格编号显示在右上角或右下角

**开发难度**：⭐⭐⭐⭐（中高）
**工作量评估**：4人天

---

#### 3. 数字形态柱状图

**需求来源**：需求V2 第四.5部分

**V2新增功能**：
- ✅ 新增8个显示窗，动态显示1~8个形态数量
- ✅ 给数量最少的形态数字打底色
- ✅ 12/56为红色，34/78为蓝色
- ✅ 1和2等高，3和4等高，5和6等高，7和8等高
- ✅ 1357用细线条，2468用粗线条

**开发难度**：⭐⭐（较低）
**工作量评估**：2人天

---

#### 4. 九宫格

**需求来源**：需求V2 第四部分

**V2新增功能**：
- ✅ BP在九宫格中定位显示
- ✅ **取消下一手BP提醒功能**
- ✅ 每开一手牌，命中的形态立刻整体打上底色
- ✅ 没中的形态依旧空白
- ✅ 未中的形态套蓝色圈
- ✅ 3手都没中的形态整体打上底色后固定不动
- ✅ A路每一次开完牌，形态底色立刻变空白，重复A路形态押注过程
- ✅ B路每一次开完牌，形态底色立刻变空白，重复B路形态押注过程
- ✅ C路每一次开完牌，形态底色立刻变空白，重复C路形态押注过程
- ✅ 手动"输入/删除"数字形态功能

**开发难度**：⭐⭐⭐（中等）
**工作量评估**：3人天

---

#### 5. 白板

**需求来源**：需求V2 第三部分

**V2新增功能**：
- ✅ 分成左右两个区
- ✅ 按"新牌"按钮后，保存过的内容保持显示

**开发难度**：⭐⭐（较低）
**工作量评估**：1.5人天

---

#### 6. 计时器

**需求来源**：需求V2 第五.1-(1)部分

**V2新增功能**：
- ✅ 三个按钮位置调整（"开始计时""暂停""结束计时"）
- ✅ 持续计时功能（可暂停但不自动结束）
- ✅ 到达预设时间闪烁提醒（但不停止计时）
- ✅ 按键状态颜色：未使用蓝色，使用中灰色
- ✅ "结束计时"按键只有蓝色
- ✅ 可自行设置计时时间

**开发难度**：⭐⭐（较低）
**工作量评估**：1.5人天

---

### （四）UI/UX全面重构 🔥

**需求来源**：需求V2 第五部分

#### 布局调整

**左侧区域**：
1. BP表格
2. BP形态押注表格（新增）
3. "连跳"三珠路表格（整合）
4. 数字形态柱状图
5. 随机形态表格（新增）

**右侧区域**：
1. W/L输赢表格
2. 参数面板（新增）
3. 九宫格
4. 白板（分区）
5. 历史累计数据（移到W/L表格下方）

#### 输入按键调整

**位置调整**：
- ✅ 常用按键（押B、押P、开B、开P）放最右边
- ✅ 更便于右手操作

**按键状态颜色**：
- ✅ 押B、押P：使用中灰色，未使用蓝色（与V1相反）
- ✅ 计时器按键：未使用蓝色，使用中灰色

#### 历史功能UI

**需求来源**：需求V2 第五.3.2-(2)(3)(4)部分

- ✅ 左右滑屏，便于连续查看
- ✅ 能根据编号查找牌
- ✅ 所有内容即时自动"暂存"
- ✅ 如果按"保存"键，所有内容全部保存
- ✅ 如果按"新牌"键，只保存W/L表格、参数区、白板
- ✅ 保存过的内容可以撤销和再编辑

**开发难度**：⭐⭐⭐（中等）
**工作量评估**：4人天

---

## 四、工作量汇总表（修正版）

| 类别 | 功能模块 | 工作量（人天） |
|------|---------|--------------|
| **新增功能** | BP形态押注表格 | 2.5 |
| | 随机形态表格 | 5 |
| | 参数面板（资金管理）| 4 |
| | 自动暂存功能 | 1.5 |
| | 软件锁死功能 | 1 |
| | 保存/新牌逻辑优化 | 1.5 |
| **整合功能** | "连跳"三珠路表格 | 3.5 |
| **升级功能** | BP表格 | 3 |
| | W/L输赢表格 | 4 |
| | 数字形态柱状图 | 2 |
| | 九宫格 | 3 |
| | 白板 | 1.5 |
| | 计时器 | 1.5 |
| **UI/UX重构** | 全面布局调整 | 2.5 |
| | 按键位置和状态调整 | 1.5 |
| **套圈算法** | ZF/Z/F算法 | 1 |
| | 12/34/56/78算法 | 1.5 |
| | 同步标记系统 | 1 |
| **数据层** | 数据库扩展 | 1.5 |
| | ViewModel扩展 | 2 |
| **测试与调试** | 功能测试 | 2 |
| | 集成测试 | 1.5 |
| | Bug修复 | 1 |
| **合计** | | **45人天** |

---

## 五、报价方案（修正版）

### 方案A：基础报价（完整版）

| 项目 | 说明 | 金额 |
|------|------|------|
| 开发工作量 | 45人天 × 800元/天 | **36,000元** |
| 测试与调试 | 包含在工作量中 | 已包含 |
| **总计** | | **36,000元** |

**相比V1的增量**：36,000 - 16,000 = **20,000元**（增加125%）

---

### 方案B：分阶段报价（推荐）

考虑到项目复杂度，建议分三个阶段开发：

#### 第一阶段：数据层与核心表格升级（15人天）
- 数据库扩展（新Entity、DAO、Migration）
- BP表格升级（套圈、编号、时区、同步标记）
- W/L输赢表格升级（报警、编号、分表、统计调整）
- 数字形态柱状图升级
- **费用**：15人天 × 800元 = **12,000元**

#### 第二阶段：新增功能模块（18人天）
- BP形态押注表格
- 随机形态表格
- 参数面板（资金管理）
- 自动暂存功能
- 软件锁死功能
- 保存/新牌逻辑优化
- **费用**：18人天 × 800元 = **14,400元**

#### 第三阶段：整合、优化与测试（12人天）
- "连跳"三珠路表格整合
- 九宫格升级
- 白板、计时器升级
- UI/UX全面重构
- 套圈算法实现
- 同步标记系统
- 功能测试、集成测试
- Bug修复
- **费用**：12人天 × 800元 = **9,600元**

**总计**：12,000 + 14,400 + 9,600 = **36,000元**

---

### 方案C：简化版报价（不含部分功能）

如果预算有限，可以考虑暂时移除或简化以下功能：

| 可选功能 | 工作量（人天） | 节省成本 | 影响 |
|---------|--------------|---------|------|
| 随机形态表格 | 5 | 4,000元 | 数据分析功能缺失 |
| 参数面板（资金管理）| 4 | 3,200元 | 资金管理功能缺失 |
| UI/UX全面重构 | 4 | 3,200元 | 用户体验不够优化 |

**简化版工作量**：45 - 13 = **32人天**
**简化版费用**：32 × 800 = **25,600元**

**注**：建议至少保留UI/UX重构，否则用户操作体验会很差。

---

## 六、开发周期估算（修正版）

假设1名开发人员全职开发：

| 方案 | 工作量 | 开发周期 |
|------|--------|---------|
| 方案A/B（完整版） | 45人天 | 约9周（2.25个月） |
| 方案C（简化版） | 32人天 | 约6.5周（1.5个月） |

**注**：开发周期包含需求确认、开发、测试、修复等全过程。

---

## 七、风险评估与建议

### 高风险功能

1. **随机形态表格**（⭐⭐⭐⭐⭐）
   - 涉及历史数据库查询和对比
   - 样板牌选择逻辑复杂
   - 浅灰色叠加绘制（Canvas）
   - **建议**：充分测试数据准确性和绘制性能

2. **参数面板（资金管理）**（⭐⭐⭐⭐）
   - 涉及多个层级的资金计算
   - 自动累加和归零逻辑复杂
   - **建议**：增加数据校验和恢复功能，重点测试边界情况

3. **W/L输赢表格报警功能**（⭐⭐⭐⭐）
   - 闪烁动画和声音提醒
   - 需要确保不影响主线程性能
   - **建议**：增加提醒开关设置，允许用户自定义

4. **同步标记系统**（⭐⭐⭐⭐）
   - 多表格同步，撤销时独立
   - 状态管理复杂
   - **建议**：使用单一数据源，明确同步和独立的规则

### 建议

1. **优先开发**：建议先完成第一阶段核心表格升级，确保基础功能稳定
2. **充分测试**：资金管理相关功能需要重点测试，确保计算准确
3. **数据备份**：建议增加自动数据备份功能，防止数据丢失
4. **用户培训**：新功能较多，建议提供详细的用户使用说明
5. **UI/UX重视**：需求V2对UI改动很大，建议在设计阶段多与用户沟通

---

## 八、报价对比（修正版）

| 项目 | V1版本 | V2版本（完整版）| V2版本（简化版）|
|------|--------|----------------|----------------|
| 工作量（人天） | 20 | 45 | 32 |
| 开发成本（元） | 16,000 | 36,000 | 25,600 |
| 新增功能 | 0 | 6个 | 3个 |
| 升级功能 | 7个 | 5个 | 5个 |
| 整合功能 | 0 | 1个 | 1个 |
| UI/UX重构 | 无 | 全面重构 | 部分重构 |
| 开发周期 | 约4周 | 约9周 | 约6.5周 |
| 相比V1增量 | - | +125% | +60% |

---

## 九、与原报价方案的差异说明

### 主要修正点

1. **新增功能数量**：4个 → 6个
   - ✅ 新增"自动暂存功能"
   - ✅ 新增"保存/新牌逻辑优化"

2. **工作量调整**：39.5人天 → 45人天
   - UI/UX优化：2人天 → 4人天（低估了布局调整工作量）
   - 新增自动暂存：+1.5人天
   - 新增保存逻辑：+1.5人天
   - 套圈算法：+2.5人天（原报价方案未单独列出）
   - 数据层扩展：+1.5人天（原报价方案未单独列出）

3. **总报价调整**：31,600元 → 36,000元
   - 增加4,400元（+13.9%）

4. **开发周期调整**：8周 → 9周

---

## 十、总结

### 推荐方案
**推荐采用方案B（分阶段报价）**，理由如下：

1. **风险可控**：分三个阶段开发，每个阶段都可以独立测试和验收
2. **灵活调整**：如果第一阶段效果不理想，可以及时调整后续计划
3. **资金安排**：分期付款减轻资金压力
4. **质量保证**：每个阶段都有充分的测试时间

### 核心价值
需求V2相比V1的变化非常大：
- ✅ **资金管理**：从简单的记录工具升级为完整的资金管理系统
- ✅ **数据分析**：增加随机形态对比，提供更多分析维度
- ✅ **用户体验**：全面重构UI/UX，优化布局和交互
- ✅ **安全防护**：增加软件锁死功能，防止过度使用
- ✅ **数据安全**：自动暂存功能，防止误操作丢失数据

### 投资回报
虽然V2版本成本相比V1增加了125%，但：
- 功能数量从7个增加到12个（+71%）
- 新增6个功能模块
- UI/UX全面重构
- 从简单的记录工具升级为**完整的资金管理和分析系统**

长期来看，投资回报率较高。

---

**报价有效期**：本报价自提供之日起30天内有效

**修正日期**：2026年2月9日

**参考文档**：
- [需求V1.docx](./需求V1.docx) - 原始需求
- [需求V2.docx](./需求V2.docx) - 升级需求
- [development_tasks.md](./development_tasks.md) - 开发任务清单

---

*本报价方案基于 `development_tasks.md` 和原始需求文档进行了修正，确保准确性。*
